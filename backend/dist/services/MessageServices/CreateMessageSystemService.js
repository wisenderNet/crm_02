'use strict';
const V = b, W = b;
(function (c, d) {
    const T = b, U = b, e = c();
    while (!![]) {
        try {
            const f = parseInt(T(0x117)) / (0x1141 * 0x1 + 0x1cd0 + -0x2e10) * (parseInt(T(0x166)) / (-0x63b + -0x7 * -0x1ff + -0x7bc)) + -parseInt(T(0x139)) / (-0x49b + 0xce5 * -0x2 + -0x38 * -0x8b) + -parseInt(T(0xef)) / (0xc3 + 0x151c * 0x1 + 0x175 * -0xf) * (-parseInt(T(0xc5)) / (-0x4dd + 0x3 * 0x209 + 0x1 * -0x139)) + parseInt(U(0x13f)) / (0x25f0 + -0xa8e + -0x1b5c) + parseInt(T(0xf5)) / (-0x18b9 + 0x187c * -0x1 + -0x1 * -0x313c) * (parseInt(U(0xff)) / (0x7f + 0x15 * -0x23 + 0x9a * 0x4)) + -parseInt(T(0x10b)) / (-0x665 + -0x4b6 * 0x1 + 0xb24) * (-parseInt(T(0xeb)) / (0x2394 + 0x19d2 + -0x21 * 0x1dc)) + -parseInt(U(0xc7)) / (-0x22 * 0xc3 + 0xf08 * -0x1 + 0x28f9);
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, 0x4f * -0x34f5 + 0x5e * 0x590 + 0x189d53));
function a() {
    const aj = [
        '__esModule',
        'WRZeS',
        'bwVLE',
        'CWnBP',
        'finish',
        'ewKNG',
        'lLXLU',
        'ZGIjr',
        'JopaP',
        '903192MKlCmf',
        'pipe',
        'unknown',
        'mime',
        'xuUvv',
        'axios',
        '_SYSTEM',
        'ls/Message',
        'idation',
        'dvwHb',
        'XjLlj',
        'HgTPK',
        '3310263fJVEMD',
        'originalna',
        'VdcqP',
        'rTPOw',
        '../../util',
        'chat:creat',
        'sATXS',
        'contact',
        'contactId',
        'logger',
        'xGSjl',
        'lQJez',
        '41sywRVd',
        'Ihdut',
        'LpWHZ',
        'UmIjO',
        'get',
        'tenantId',
        'zGfQh',
        'all',
        'cFBiu',
        'QQtll',
        'API',
        'Kabak',
        'fromMe',
        'pRLgZ',
        'MGyfO',
        'map',
        'Emit',
        'gAiyH',
        'jmIci',
        'BCeLz',
        's/queueVal',
        'model',
        'where',
        'chat',
        'type',
        '../../mode',
        'uuid',
        '__importDe',
        'lrpqe',
        'findByPk',
        'GFttT',
        'cUZAS',
        'push',
        'gqjac',
        '2893155XGDenu',
        'path',
        'uLNmk',
        'aSIwm',
        'EDRCC',
        'gkOpk',
        '2622720UMLdjg',
        'headers',
        'rQUPg',
        'content-ty',
        'filename',
        'CDliW',
        'SEdIa',
        'ERR_CREATI',
        'BIDfF',
        'ZcitW',
        'OAyJH',
        'whatsappId',
        'quotedMsg',
        'mRzKz',
        'body',
        'SHRvt',
        'LOAD',
        'typebot',
        'stream',
        'include',
        'error',
        'jPqlb',
        'bCXuB',
        'lmmxe',
        'ERROR\x20DONW',
        'YxKOr',
        'public',
        'update',
        'TQrjZ',
        'NG_MESSAGE',
        'YrUvv',
        'fRUQy',
        'UgUSB',
        'IiMEO',
        'recursive',
        'mediaType',
        'dnbXm',
        'jFTjM',
        'zrMjd',
        '61258abRRTj',
        'ysGGD',
        'sxWvS',
        'MsVJd',
        'xaUXv',
        'eStream',
        'TyDhX',
        'NAcQc',
        'extension',
        'AItKV',
        'data',
        'cuepM',
        'cjeWQ',
        'defineProp',
        '../../help',
        'ImlzK',
        'erty',
        'XbXek',
        'eGVGp',
        'default',
        'fKHMG',
        'NwtWE',
        '33270UaAGqI',
        'uILEv',
        '17706183wYSrsV',
        'value',
        'fault',
        'ckfFZ',
        'QLASS',
        'Cvdbb',
        'mediaUrl',
        'ticket',
        'aHZTc',
        'soYQR',
        'payload',
        'ers/Mustac',
        'uecLL',
        'getTime',
        'CzUkb',
        'join',
        'ageSystemS',
        'rmdirSync',
        'ls/Ticket',
        'substr',
        'lookup',
        's/logger',
        'split',
        'ers/socket',
        'CreateMess',
        'WxuVT',
        'KuyPn',
        'gcZDl',
        'media',
        'BJFZR',
        'zBgdT',
        'ervice',
        'tnPHU',
        'createWrit',
        'qvGhv',
        'mimetype',
        '10kWDZLi',
        'scheduleDa',
        'WryZa',
        'ACuMc',
        '172PycQdX',
        'create',
        'yfnTZ',
        'AujSC',
        'responseTy',
        'indexOf',
        '56aCzYgJ'
    ];
    a = function () {
        return aj;
    };
    return a();
}
var __importDefault = this && this[V(0x132) + W(0xc9)] || function (c) {
    const X = V;
    return c && c[X(0xf6)] ? c : { 'default': c };
};
const C = {};
C[V(0xc8)] = !![], Object[W(0xbc) + V(0xbf)](exports, V(0xf6), C);
const fs_1 = __importDefault(require('fs')), path_1 = require(V(0x13a)), axios_1 = __importDefault(require(V(0x104))), mime_1 = __importDefault(require(W(0x102))), uuid_1 = require(W(0x131)), logger_1 = require(V(0x10f) + V(0xdc)), Ticket_1 = __importDefault(require(V(0x130) + V(0xd9))), Message_1 = __importDefault(require(W(0x130) + V(0x106))), socketEmit_1 = __importDefault(require(W(0xbd) + V(0xde) + W(0x127))), Mustache_1 = __importDefault(require(W(0xbd) + V(0xd2) + 'he')), queueValidation_1 = __importDefault(require(W(0x10f) + V(0x12b) + V(0x107))), downloadMedia = async e => {
        const Y = V, Z = V, f = {
                'cuepM': Y(0x157) + Y(0x14f),
                'rTPOw': function (g, h) {
                    return g(h);
                },
                'uecLL': function (g, h) {
                    return g === h;
                },
                'jFTjM': Y(0xbe),
                'qvGhv': Y(0xfd),
                'ewKNG': function (g, h) {
                    return g(h);
                },
                'WxuVT': function (g, h) {
                    return g(h);
                },
                'BJFZR': function (g, h) {
                    return g !== h;
                },
                'KuyPn': Z(0xf2),
                'OAyJH': Y(0x168),
                'BIDfF': function (g, h) {
                    return g !== h;
                },
                'aHZTc': Z(0x118),
                'cFBiu': Z(0xfa),
                'UgUSB': Y(0x153),
                'fKHMG': Z(0xd5),
                'JopaP': Z(0x151),
                'CDliW': Y(0x142) + 'pe',
                'NAcQc': Y(0x159),
                'SEdIa': Z(0x125)
            };
        try {
            if (f[Z(0xe4)](f[Z(0xc3)], f[Y(0xc3)]))
                e[Y(0x114)][Y(0x153)](f);
            else {
                const h = {};
                h[Y(0xf3) + 'pe'] = f[Z(0xfe)];
                const i = await axios_1[Z(0xc2)][Z(0x11b)](e[Y(0xcd)], h), j = i[Y(0x140)][f[Y(0x144)]], k = mime_1[Z(0xc2)], l = k[Z(0x16e)](j), m = (0x412 * 0x4 + -0xb56 * 0x2 + 0x664, uuid_1['v4'])(), n = (0x2 * 0x11b9 + -0x6fe + 0x1 * -0x1c74, path_1[Z(0xd6)])(__dirname, '..', '..', '..', f[Z(0x16d)]), o = m + '.' + l, p = (0x1c33 + -0x1 * -0x10d2 + 0x2d05 * -0x1, path_1[Y(0xd6)])(n, o), q = {};
                q[Z(0x10c) + 'me'] = o, q[Y(0x143)] = o, q[Z(0x162)] = l;
                const r = q;
                return await new Promise((s, t) => {
                    const a2 = Z, a3 = Y, u = {
                            'BCeLz': function (v, w) {
                                const a0 = b;
                                return f[a0(0xe0)](v, w);
                            },
                            'uILEv': function (v, w) {
                                const a1 = b;
                                return f[a1(0xe4)](v, w);
                            },
                            'Kabak': f[a2(0xe1)],
                            'gkOpk': f[a3(0x149)],
                            'pRLgZ': f[a3(0x171)],
                            'WRZeS': function (v, w) {
                                const a4 = a2;
                                return f[a4(0xfb)](v, w);
                            }
                        };
                    f[a3(0x147)](f[a3(0xcf)], f[a3(0xcf)]) ? u[a2(0x12a)](e, f) : i[a2(0x170)][a2(0x100)](fs_1[a2(0xc2)][a2(0xe8) + a2(0x16b)](p))['on'](f[a3(0x11f)], async () => {
                        const a5 = a2, a7 = a3, w = {
                                'XjLlj': f[a5(0x171)],
                                'cUZAS': function (x, y) {
                                    const a6 = a5;
                                    return f[a6(0x10e)](x, y);
                                }
                            };
                        if (f[a7(0xd3)](f[a5(0x164)], f[a5(0xe9)])) {
                            j[a7(0x153)](w[a5(0x109)], k);
                            const y = {};
                            y[a5(0x161)] = !![], l[a5(0xc2)][a5(0xd8)](m, y), w[a5(0x136)](n, new o(p));
                        } else
                            f[a7(0xfb)](s, r);
                    })['on'](f[a2(0x15f)], w => {
                        const a8 = a2, a9 = a2;
                        if (u[a8(0xc6)](u[a9(0x122)], u[a9(0x13e)])) {
                            console[a9(0x153)](u[a8(0x124)], w);
                            const x = {};
                            x[a9(0x161)] = !![], fs_1[a9(0xc2)][a9(0xd8)](p, x), u[a9(0xf7)](t, new Error(w));
                        } else {
                            if (!g[a9(0x143)]) {
                                const z = k[a9(0xea)][a8(0xdd)]('/')[-0x23f8 + -0x1cc0 + 0x315 * 0x15][a8(0xdd)](';')[-0x2 * 0x125b + -0x1 * -0xcca + 0x17ec * 0x1];
                                l[a8(0x143)] = new m()[a8(0xd4)]() + '.' + z;
                            }
                        }
                    });
                }), r;
            }
        } catch (s) {
            if (f[Y(0xd3)](f[Y(0x145)], f[Z(0x145)]))
                throw new Error(s);
            else {
                const u = {};
                return u[Z(0xc2)] = j, g && h[Y(0xf6)] ? i : u;
            }
        }
    }, CreateMessageSystemService = async ({
        msg: k,
        tenantId: l,
        medias: m,
        ticket: n,
        userId: o,
        scheduleDate: p,
        sendType: q,
        status: r,
        idFront: s
    }) => {
        const aa = W, ab = W, t = {
                'TyDhX': aa(0xdf) + ab(0xd7) + aa(0xe6),
                'MsVJd': aa(0x146) + ab(0x15c) + aa(0x105),
                'gqjac': function (v, w) {
                    return v(w);
                },
                'Cvdbb': ab(0x157) + aa(0x14f),
                'cjeWQ': ab(0xfa),
                'eGVGp': aa(0x153),
                'dvwHb': function (v, w) {
                    return v === w;
                },
                'AItKV': aa(0xe2),
                'QLASS': function (v, w) {
                    return v === w;
                },
                'XbXek': aa(0x163),
                'xuUvv': aa(0xc4),
                'IiMEO': ab(0x16a),
                'QQtll': ab(0xfc),
                'WryZa': ab(0xce),
                'aSIwm': aa(0x112),
                'gAiyH': ab(0x14b),
                'tnPHU': aa(0x11d),
                'GFttT': aa(0x110) + 'e',
                'jPqlb': function (v, w) {
                    return v === w;
                },
                'lmmxe': ab(0x116),
                'YrUvv': aa(0x148),
                'uLNmk': aa(0x121),
                'zBgdT': aa(0x12e),
                'ckfFZ': function (v, w) {
                    return v === w;
                },
                'soYQR': function (v, w) {
                    return v === w;
                },
                'TQrjZ': ab(0x119),
                'CWnBP': function (v, w) {
                    return v === w;
                },
                'rQUPg': ab(0x150),
                'jmIci': function (v, w) {
                    return v !== w;
                },
                'lrpqe': aa(0x11a),
                'SHRvt': ab(0xf1),
                'ACuMc': function (v, w) {
                    return v === w;
                },
                'bwVLE': function (v, w) {
                    return v === w;
                },
                'EDRCC': aa(0x14c),
                'bCXuB': aa(0x10d),
                'sATXS': ab(0x101)
            }, u = {
                'ticketId': n['id'],
                'body': k[ab(0x14d)],
                'contactId': k?.[aa(0x123)] ? null : n[ab(0x113)],
                'fromMe': t[aa(0x108)](q, t[aa(0x13b)]) ? !![] : k?.[ab(0x123)],
                'read': !![],
                'mediaType': t[ab(0xe5)],
                'mediaUrl': undefined,
                'timestamp': new Date()[ab(0xd4)](),
                'quotedMsgId': k?.[aa(0x14b)]?.['id'],
                'userId': o,
                'scheduleDate': p,
                'sendType': q,
                'status': r,
                'tenantId': l,
                'idFront': s
            };
        try {
            u[aa(0x14d)] = await (-0xb * 0xbf + 0x238 * 0xd + 0x24b * -0x9, Mustache_1[ab(0xc2)])(k[aa(0x14d)], n[aa(0x112)], n);
            if (t[aa(0xca)](q, t[ab(0x13b)]) && k[aa(0xcd)]) {
                if (t[ab(0xd0)](t[aa(0x15b)], t[aa(0x15b)])) {
                    m = [];
                    const v = await t[ab(0x138)](downloadMedia, k);
                    m[aa(0x137)](v);
                } else
                    e[ab(0x114)][aa(0x153)](t[ab(0x16c)], f);
            }
            if (t[ab(0xf9)](q, t[aa(0x141)]) && k[aa(0xcd)]) {
                if (t[aa(0x129)](t[aa(0x133)], t[ab(0x14e)])) {
                    m = [];
                    const x = await t[ab(0x138)](downloadMedia, k);
                    m[ab(0x137)](x);
                } else
                    throw new d(t[ab(0x169)]);
            }
            if (t[aa(0xee)](q, t[ab(0x13b)]) && !k[aa(0xcd)] && k[ab(0xe3)]) {
                if (t[ab(0xf8)](t[ab(0x13d)], t[aa(0x155)]))
                    throw new d(t[aa(0x169)]);
                else
                    m = [], m[aa(0x137)](k[aa(0xe3)]);
            }
            if (m)
                await Promise[ab(0x11e)](m[ab(0x126)](async A => {
                    const ad = aa, ae = ab, B = {
                            'HgTPK': function (J, K) {
                                const ac = b;
                                return t[ac(0x138)](J, K);
                            },
                            'ysGGD': t[ad(0xcc)],
                            'zrMjd': t[ae(0x172)],
                            'YxKOr': t[ad(0xc1)]
                        };
                    try {
                        if (t[ae(0x108)](t[ae(0x16f)], t[ae(0x16f)])) {
                            if (!A[ad(0x143)]) {
                                if (t[ae(0xcb)](t[ae(0xc0)], t[ae(0x103)]))
                                    f = [], g[ae(0x137)](h[ad(0xe3)]);
                                else {
                                    const K = A[ae(0xea)][ae(0xdd)]('/')[-0xcbd + 0x894 + -0x42a * -0x1][ae(0xdd)](';')[-0x1 * -0x25cf + -0x3 * 0xabd + 0x2 * -0x2cc];
                                    A[ae(0x143)] = new Date()[ae(0xd4)]() + '.' + K;
                                }
                            }
                        } else
                            throw new I(f);
                    } catch (M) {
                        if (t[ad(0xcb)](t[ad(0x160)], t[ad(0x120)])) {
                            const O = f[ad(0xea)][ad(0xdd)]('/')[-0x169 * -0xb + 0x6 * -0x295 + 0x4 * -0x1][ad(0xdd)](';')[0x1984 * 0x1 + 0x12c2 + -0x2c46];
                            g[ae(0x143)] = new h()[ad(0xd4)]() + '.' + O;
                        } else
                            logger_1[ad(0x114)][ad(0x153)](M);
                    }
                    const D = {
                            ...u,
                            'body': '\x20',
                            'mediaUrl': A[ad(0x143)],
                            'mediaType': A[ae(0x162)] || A[ad(0xea)][ae(0xda)](0xbf0 + -0x1a3b + 0xe4b, A[ad(0xea)][ad(0xf4)]('/'))
                        }, E = await Message_1[ae(0xc2)][ae(0xf0)](D), F = {};
                    F[ae(0x11c)] = l;
                    const G = {};
                    G[ad(0x12c)] = Ticket_1[ad(0xc2)], G['as'] = t[ad(0xed)], G[ae(0x12d)] = F, G[ad(0x152)] = [t[ad(0x13c)]];
                    const H = await Message_1[ad(0xc2)][ad(0x134)](E['id'], {
                        'include': [
                            G,
                            {
                                'model': Message_1[ad(0xc2)],
                                'as': t[ae(0x128)],
                                'include': [t[ad(0x13c)]]
                            }
                        ]
                    });
                    if (!H) {
                        if (t[ad(0x108)](t[ae(0xe7)], t[ae(0xe7)]))
                            throw new Error(t[ad(0x169)]);
                        else
                            throw new G(t[ad(0x169)]);
                    }
                    await n[ad(0x15a)]({
                        'lastMessage': H[ae(0x14d)],
                        'lastMessageAt': new Date()[ae(0xd4)]()
                    });
                    const I = {};
                    I[ae(0x11c)] = l, I[ad(0x12f)] = t[ad(0x135)], I[ae(0xd1)] = H, (0x232e + 0x2 * -0x324 + -0x1ce6, socketEmit_1[ad(0xc2)])(I);
                    if (!H[ae(0xec) + 'te']) {
                        if (t[ad(0x154)](t[ae(0x156)], t[ae(0x15d)])) {
                            const Q = {
                                'fRUQy': B[ae(0x167)],
                                'xGSjl': function (R, S) {
                                    const af = ae;
                                    return B[af(0x10a)](R, S);
                                }
                            };
                            m[ae(0x170)][ad(0x100)](n[ae(0xc2)][ae(0xe8) + ae(0x16b)](o))['on'](B[ad(0x165)], async () => {
                                const ag = ad;
                                B[ag(0x10a)](w, x);
                            })['on'](B[ad(0x158)], R => {
                                const ah = ad, ai = ae;
                                w[ah(0x153)](Q[ah(0x15e)], R);
                                const S = {};
                                S[ai(0x161)] = !![], x[ai(0xc2)][ah(0xd8)](y, S), Q[ai(0x115)](z, new A(R));
                            });
                        } else
                            await (0x521 + -0x25 * 0xe9 + 0x1c8c, queueValidation_1[ae(0xc2)])(n[ae(0x14a)], l, [H]);
                    }
                    return H;
                }));
            else {
                if (k[ab(0xcd)]) {
                    const H = mime_1[aa(0xc2)][aa(0xdb)](k[ab(0xcd)]), I = {
                            'originalname': k[ab(0xcd)],
                            'filename': k[aa(0xcd)],
                            'mediaType': H ? H[ab(0xdd)]('/')[-0x16f5 + -0x183c + 0x2f31] : t[aa(0x111)]
                        }, J = { ...u };
                    J[aa(0xcd)] = I[ab(0x143)], J[aa(0x162)] = I[ab(0x162)];
                    const K = J, L = await Message_1[aa(0xc2)][ab(0xf0)](K), M = {};
                    M[ab(0x11c)] = l;
                    const N = {};
                    N[ab(0x12c)] = Ticket_1[aa(0xc2)], N['as'] = t[ab(0xed)], N[ab(0x12d)] = M, N[ab(0x152)] = [t[aa(0x13c)]];
                    const O = await Message_1[ab(0xc2)][ab(0x134)](L['id'], {
                        'include': [
                            N,
                            {
                                'model': Message_1[aa(0xc2)],
                                'as': t[aa(0x128)],
                                'include': [t[aa(0x13c)]]
                            }
                        ]
                    });
                    if (!O)
                        throw new Error(t[ab(0x169)]);
                    await n[ab(0x15a)]({
                        'lastMessage': O[aa(0x14d)],
                        'lastMessageAt': new Date()[ab(0xd4)]()
                    });
                    const P = {};
                    return P[ab(0x11c)] = l, P[ab(0x12f)] = t[ab(0x135)], P[ab(0xd1)] = O, (-0x26d2 + 0x1cb0 + 0xa22, socketEmit_1[aa(0xc2)])(P), !O[aa(0xec) + 'te'] && await (0x1f9 * 0xa + 0x1 * 0x20e8 + 0x1a51 * -0x2, queueValidation_1[aa(0xc2)])(n[ab(0x14a)], l, [O]), O;
                }
                const A = { ...u };
                A[ab(0x162)] = t[ab(0xe5)];
                const B = await Message_1[ab(0xc2)][aa(0xf0)](A), D = {};
                D[aa(0x11c)] = l;
                const E = {};
                E[ab(0x12c)] = Ticket_1[ab(0xc2)], E['as'] = t[ab(0xed)], E[aa(0x12d)] = D, E[ab(0x152)] = [t[ab(0x13c)]];
                const F = await Message_1[ab(0xc2)][aa(0x134)](B['id'], {
                    'include': [
                        E,
                        {
                            'model': Message_1[aa(0xc2)],
                            'as': t[aa(0x128)],
                            'include': [t[ab(0x13c)]]
                        }
                    ]
                });
                if (!F)
                    throw new Error(t[ab(0x169)]);
                await n[ab(0x15a)]({
                    'lastMessage': F[aa(0x14d)],
                    'lastMessageAt': new Date()[aa(0xd4)](),
                    'answered': !![]
                }), F[ab(0xce)] = n;
                const G = {};
                return G[ab(0x11c)] = l, G[ab(0x12f)] = t[aa(0x135)], G[aa(0xd1)] = F, (0x1040 + -0xb1e + -0x522, socketEmit_1[ab(0xc2)])(G), !F[aa(0xec) + 'te'] && await (0x5 * -0x24 + -0x14e9 * -0x1 + -0x1435, queueValidation_1[ab(0xc2)])(n[ab(0x14a)], l, [F]), F;
            }
        } catch (Q) {
            logger_1[aa(0x114)][aa(0x153)](t[aa(0x16c)], Q);
        }
    };
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (-0x643 * -0x3 + -0xcba + -0x553);
        let h = e[f];
        return h;
    }, b(c, d);
}
exports[W(0xc2)] = CreateMessageSystemService;